---
layout: post
title: "개츠비에서 오프라인으로 전환 중"
author: 'Code Tower'
thumbnail: https://blog.logrocket.com/wp-content/uploads/2020/12/goingofflineingatsby.png
tags: undefined
---


![image](https://i0.wp.com/blog.logrocket.com/wp-content/uploads/2020/12/goingofflineingatsby.png?fit=730%2C487&ssl=1)

개츠비와 함께 건물을 짓는다는 것은 설정에 필요한 많은 무거운 리프팅이 자동적으로 당신을 위해 처리된다는 것을 의미하므로 당신은 UI를 위한 코드 작성에 집중할 수 있다. 그러나 개츠비는 오프라인 기능이나 일반적으로 PWA(Progressive Web Apps)로 알려진 기능을 즉시 사용할 수 없습니다.

PWA는 인터넷 연결 없이도 전체 또는 부분적으로 탐색할 수 있는 웹 사이트로, 브라우저에서 바로 기본 앱과 마찬가지로 장치에 설치할 수 있습니다. PWA 자격을 얻으려면 사이트가 충족해야 하는 세 가지 기준 기준이 있습니다. 요약하면 다음과 같습니다.

- 매니페스트 파일이 있어야 합니다.
- 서비스 직원을 사용하여 리소스 캐시 및 네트워크 요청 가로채기
- HTTPS를 통해 서비스해야 함

이 글에서, 저는 어떻게 개츠비가 운영하는 웹사이트를 PWA로 변환시켰는지 그리고 어떻게 그렇게 할 수 있는지 자세히 설명하려고 합니다.

![image](https://i1.wp.com/blog.logrocket.com/wp-content/uploads/2020/12/lighthouse-report-before-pwa.png?resize=730%2C289&ssl=1)

## 1단계: 매니페스트 추가

매니페스트는 브라우저에서 웹 사이트를 설치할 수 있도록 지시하고 `홈 화면에 추가` 기능을 사용하도록 설정하는 JSON 파일입니다. 또한 장치에 설치할 때 사이트가 어떻게 동작해야 하는지 설명합니다. 매니페스트 파일에서 앱 이름, 아이콘 및 기본 URL과 같은 항목을 정의하여 장치의 홈 화면에서 앱을 실행할 때 탐색해야 합니다.

거의 모든 것과 마찬가지로, 개츠비는 이 과정을 더 쉽게 만들 수 있는 플러그인을 제공합니다.

시작하려면 플러그인을 설치하십시오.

```undefined
npm install gatsby-plugin-manifest
```

그런 다음 `gatsby-config.js` 파일에 플러그인을 추가하고 구성하십시오.

```coffeescript
plugins: [
    {
      resolve: `gatsby-plugin-manifest`,
      options: {
        name: `CodeWithLinda`,
        short_name: `CodeWithLinda`,
        start_url: `/`,
        background_color: `#212121`,
        theme_color: `#f39ca9`,
        display: `standalone`,
        icon: `src/images/icon.png`
      },
    },
  ],
```

구성 속성을 설명하겠습니다.

- `name` – 브라우저에서 사이트가 앱으로 설치될 때 표시되는 이름
- `short_name` – 사용자의 홈 화면, 시작 프로그램 또는 공간이 제한될 수 있는 다른 위치에 표시되는 이름
- `start_url` – 앱이 장치 홈 화면에서 실행될 때 탐색할 URL을 브라우저에 알려줍니다. 당신의 홈페이지 URL이라고 생각하세요.
- `background_color` – 모바일에서 애플리케이션을 처음 시작할 때 스플래시 화면에 사용되는 색상
- `color_color` – 홈 스크린에서 앱을 실행할 때 브라우저의 도구 모음 색
- `display` – 앱이 실행될 때 브라우저 UI를 표시하는 방법을 지정합니다. 전체 화면, 독립 실행형, 최소 UI 및 브라우저 옵션 포함
- icon(아이콘) - 다양한 크기의 다양한 장치 크기에 대한 아이콘 배열입니다. 이러한 아이콘은 홈 화면, 앱 실행기, 작업 전환기, 스플래시 화면 등에 사용됩니다. 개츠비는 기본 512×512를 제공하며 다른 화면의 다른 크기를 자동으로 생성합니다.

매니페스트가 올바르게 설정되었는지 테스트하고 확인하려면 dev 서버를 다시 시작해야 합니다. 이를 위해 Ctrl/Cmd + C로 포트를 중지한 다음 개발별 게이트를 다시 실행합니다. Chrome dev 도구의 애플리케이션 패널에 있는 매니페스트 창을 사용하여 다음을 확인합니다.

![image](https://i1.wp.com/blog.logrocket.com/wp-content/uploads/2020/12/manifest-detected.png?resize=730%2C500&ssl=1)

보시다시피 매니페스트가 탐지되고 있습니다.

## 2단계: 서비스 직원에 오프라인 지원 추가

서비스 작업자는 브라우저에 의해 실행되는 자바스크립트 파일로, 브라우저의 캐시 저장소를 사용하여 웹 사이트의 리소스를 캐시한 후 사용자가 요청할 때 브라우저의 캐시에서 리소스를 가져오도록 네트워크 요청을 차단하는 것이 주된 목적이다. 이렇게 하면 인터넷 연결이 없어도 사이트를 탐색할 수 있습니다.

매니페스트 플러그인과 마찬가지로 개츠비는 서비스 직원을 추가하는 플러그인을 가지고 있는데, 이 플러그인은 워크박스 빌드를 사용하여 사이트에 대한 서비스 직원을 만든 다음 서비스 직원을 클라이언트에 로드합니다.

시작하기 위해서. 플러그인 설치:

```undefined
npm install gatsby-plugin-offline
```

그런 다음 `gatsby config.js` 파일에 플러그인을 추가하고 구성하십시오.

```coffeescript
plugins: [
{
  resolve: `gatsby-plugin-offline`,
  options: {
    precachePages: [`/`, `/blog/*`],
  },
},
]
```

`precache Pages`를 사용하면 서비스 작업자가 리소스를 미리 할당해야 하는 페이지 배열을 지정할 수 있습니다. 위의 코드 샘플에서, 홈페이지와 URL이 /blog/로 시작하는 모든 페이지를 미리 정리하고 있습니다. 여기에는 블로그 페이지와 모든 개별 블로그 게시물이 포함됩니다.

대부분의 경우 이 구성만 있으면 됩니다.

gastby-config.js 파일의 `gatsby-plugin-manfest` 뒤에 `gats by-plugin-offline`을 구성해야 합니다. 이렇게 하면 오프라인 플러그인이 생성된 매니페스트 파일도 캐시할 수 있습니다.

개발 모드에서는 서비스 직원을 테스트할 수 없습니다. 빌드별 Gats 및 서비스별 Gatsby Service를 실행하여 웹 사이트를 테스트,

![image](https://i0.wp.com/blog.logrocket.com/wp-content/uploads/2020/12/lighthouse-report-after-pwa.png?resize=730%2C373&ssl=1)

보시다시피 웹 사이트를 PWA로 변환하면 성능 메트릭뿐만 아니라 모범 사례 메트릭도 향상됩니다.

주의사항이 있습니다. 서비스 근로자들은 무서운 기쁨이 될 수 있습니다. UX 개선을 목표로 하는 만큼 제대로 처리되지 않으면 업데이트 문제로 인해 불량 UX의 원인이 될 수 있다.

개츠비에서는 프로젝트를 변경하고 배포할 때 고유한 파일 이름을 가진 새 파일이 생성됩니다. 이로 인해 서비스 작업자 파일이 업데이트됩니다. 그러나 브라우저는 세 가지 시나리오에서만 서비스 작업자 파일에 대한 업데이트를 찾습니다. 사용자가 페이지를 다시 로드하거나, 사용자가 다른 페이지로 이동하거나, 마지막 업데이트 후 최소 24시간 후에 발생하는 모든 방문 시 정기적으로 업데이트를 찾습니다. 서비스 작업자 라이프사이클에 따라 브라우저가 이러한 작업 중에 업데이트된 서비스 작업자를 찾으면 해당 작업자의 설치를 시작합니다. 설치가 완료되면 업데이트된 서비스 작업자가 즉시 활성화되지 않고 현재 서비스 작업자가 제어하는 다른 모든 탭이 닫힐 때까지 기다립니다.

즉, 방문자가 이미 열려 있는 웹 사이트 탭을 잊어버리거나 가끔 웹 사이트를 닫았다가 다시 열지 않으면 서비스 직원이 업데이트되지 않을 수 있으며 사용자는 이전 버전의 웹 사이트에 갇히게 됩니다. 해결책으로 gats by-plugin-offline 워크박스 구성은 서비스 작업자의 skipWaiting을 true로 설정합니다. 이렇게 하면 대기 기간에 머무르지 않고 설치가 끝나는 대로 새 서비스 직원이 활성화될 수 있습니다. 이렇게 하면 사용자는 가능한 한 빨리 당사 사이트에 대한 최신 업데이트를 받을 수 있습니다.

현재 유일한 문제는 새로운 서비스 직원이 활성화되는 즉시 개츠비가 경로 변경 시 전체 사이트 재장전을 시작할 것이라는 점이다. 사용자가 사이트에서 양식을 작성하는 것과 같이 작업을 수행하는 경우, 다시 시작해야 할 가능성이 높습니다. UX가 안 좋아요.

우리는 skip waiting을 연기함으로써 서비스 작업자 업데이트 흐름을 개선한 다음 사용자가 클릭할 수 있는 업데이트 버튼이나 배너를 표시하여 재로드를 시작하고 사용자가 편리한 시간에 사이트를 최신 변경으로 업데이트할 수 있습니다. Jakub Ziebikiewicz는 서비스 직공 업데이터 패키지를 사용하여 이 작업을 수행하는 방법에 대해 꽤 쉽게 이해할 수 있는 가이드를 작성했습니다. 여기서 읽을 수 있는 다른 지연 전략도 있습니다.

또한 어떤 이유로든 `gatsby-offline-plugin`을 사용하지 않으려는 경우 static 폴더에 `sw.js`를 추가한 다음 `gatsby-browser.js` 파일에 해당 서비스 근로자를 등록하여 사용자 지정 서비스 근로자를 작성할 수 있습니다.

```js
//in gatsby-browser.js

export const registerServiceWorker = () => true
```

## 3단계: HTTPS를 통해 서비스

개발 중에는 로컬 호스트에서 서비스 직원에 액세스하고 테스트할 수 있지만, 방문자가 액세스할 수 있으려면 HTTP가 아닌 HTTPS를 통해 사이트를 서비스해야 합니다. 서비스 종사자들이 네트워크 요청을 가로채고 응답을 변경할 수 있는 능력이 있어 통신 채널이 `중간` 공격에 취약하기 때문이다. HTTPS를 통한 서비스 직원은 통신 채널이 안전하고 네트워크를 통과하는 동안 조작되지 않도록 보장합니다.

GitHub 페이지 또는 Netliify에서 사이트를 호스트하는 경우 HTTPS는 기본적으로 사용하도록 설정됩니다. 그렇지 않으면 호스팅 공급자에 따라 호스팅 공급자가 SSL 인증서를 지원하는 경우 무료 암호화 SSL 인증서를 사용하거나 SSL 인증서를 구입하여 호스팅 공급자와 함께 구성할 수 있습니다. 구글 검색으로 당신이 알아야 할 모든 것을 찾을 수 있을 것이다.

## 결론

웹 사이트에 오프라인 기능을 추가하는 것은 불필요하지만 사용자의 사이트 성능을 향상시키고 방문자의 경험을 업그레이드하여 휴대폰과 같은 대역폭이 낮은 장치나 지하 터널, 엘리베이터, 기타 수신 기능이 없는 장소에서 웹 사이트의 전체 또는 일부에 계속 액세스할 수 있습니다.비행기의

서비스 직원에 대해, 사용자 지정 업데이트 흐름을 활용한다면 댓글로 듣고 싶습니다. 그때까지, 계속해서 멋진 것들을 만드세요!